<script>
// ─── MEJORA TÉCNICA: CONFIGURACIÓN PROFESIONAL DE TINYMCE ───
tinymce.init({
  selector: '#editor-blogger',
  height: 480,
  plugins: 'advlist autolink lists link image charmap preview anchor searchreplace visualblocks code fullscreen insertdatetime media table help wordcount emoticons',
  toolbar: 'undo redo | blocks | bold italic forecolor | alignleft aligncenter alignright alignjustify | bullist numlist | removeformat | help',
  skin: 'oxide-dark',
  content_css: 'dark',
  branding: false,
  promotion: false,
  setup: function(editor) {
    editor.on('change', function() {
      // Sincroniza el contenido con el campo oculto para que Python lo reciba
      document.getElementById('contenido-hidden').value = editor.getContent();
    });
  }
});

// ─── MEJORA TÉCNICA: GENERADOR DE SLUGS PARA SEO ───
function onTitulo() {
  const titulo = document.getElementById('titulo-input').value.trim();
  const ciudad = document.getElementById('ciudad-input').value.trim();
  
  // Crea una URL amigable automáticamente
  const slug = titulo.toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .replace(/[^a-z0-9\s]/g,'')
    .replace(/\s+/g,'-');

  document.getElementById('seo-url').textContent = `elfarol.com > noticia > ${ciudad.toLowerCase()}-${slug}`;
  document.getElementById('seo-title').textContent = titulo || "Tu titular aparecerá aquí...";
  
  // Contador de caracteres con color dinámico
  const tc = titulo.length;
  const counter = document.getElementById('titulo-chars');
  counter.textContent = tc + ' / 100';
  counter.className = 'char-counter ' + (tc > 80 ? 'bad' : tc > 60 ? 'warn' : 'ok');
}

// ─── MEJORA TÉCNICA: PREPARACIÓN ANTES DE ENVIAR ───
document.getElementById('form-principal').onsubmit = function() {
    // Asegura que el contenido del editor se guarde antes de enviar el formulario
    const content = tinymce.get('editor-blogger').getContent();
    document.getElementById('contenido-hidden').value = content;
    return true; 
};
</script>
