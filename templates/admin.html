<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editor Maestro | El Farol</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.3/tinymce.min.js"></script>

<style>
  :root { --naranja: #FF5500; --bg: #080808; --surface: #111; --borde: #222; --sidebar-w: 260px; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: #E8E0D4; display: flex; margin: 0; }
  .sidebar { width: var(--sidebar-w); height: 100vh; background: var(--surface); position: fixed; border-right: 1px solid var(--borde); text-align: center; }
  .main-content { margin-left: var(--sidebar-w); width: calc(100% - var(--sidebar-w)); padding: 20px; }
  .card { background: rgba(255,255,255,0.02); border: 1px solid var(--borde); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
  input { background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; }
  #titulo-input { font-family: 'Bebas Neue'; font-size: 28px; color: var(--naranja); }
  .btn-publish { background: var(--naranja); color: #fff; border: none; padding: 18px; border-radius: 10px; font-family: 'Bebas Neue'; font-size: 20px; width: 100%; cursor: pointer; box-shadow: 0 5px 15px rgba(255,85,0,0.3); }
  .btn-publish:hover { background: #ff6622; }
</style>
</head>
<body>

<aside class="sidebar">
  <div style="background:var(--naranja); width:50px; height:50px; margin:20px auto; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:24px;">üèÆ</div>
  <h2 style="font-family:'Bebas Neue'; color:var(--naranja);">EL FAROL</h2>
</aside>

<div class="main-content">
  <form method="POST" action="/admin" id="noticia-form">
    <input type="hidden" name="contenido" id="hidden-content">

    <div class="card">
      <label style="font-family:'JetBrains Mono'; font-size:10px; color:#555;">TITULAR</label>
      <input type="text" id="titulo-input" name="titulo" placeholder="ESCRIBA EL TITULAR..." required>
      
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-top:15px;">
        <input type="text" name="ciudad" placeholder="Ciudad" required>
        <input type="text" name="protagonista" placeholder="Protagonista" required>
      </div>
      <input type="text" name="multimedia" placeholder="URL Multimedia" style="margin-top:15px;">
    </div>

    <div class="card" style="padding:5px;">
       <textarea id="tinymce-editor"></textarea>
    </div>

    <button type="submit" class="btn-publish" onclick="validarYEnviar(event)">
      <i class="fas fa-bolt"></i> LANZAR AHORA
    </button>
  </form>
</div>

<script>
tinymce.init({
  selector: '#tinymce-editor',
  height: 400,
  skin: 'oxide-dark',
  content_css: 'dark',
  branding: false,
  setup: function(ed) { ed.on('change', function() { ed.save(); }); }
});

function validarYEnviar(e) {
  e.preventDefault();
  const form = document.getElementById('noticia-form');
  const content = tinymce.get('tinymce-editor').getContent();
  
  if (content.length < 10) {
    alert("Error: El cuerpo de la noticia est√° vac√≠o.");
    return;
  }

  document.getElementById('hidden-content').value = content;
  
  // LOG PARA DETECTAR EL FALLO EN CONSOLA
  console.log("Intentando env√≠o a Railway...");
  
  // Verificamos si el servidor responde
  fetch(form.action, {
    method: 'POST',
    body: new FormData(form)
  }).then(response => {
    if (response.ok) {
      window.location.href = "/"; // Si todo sale bien, va al inicio
    } else {
      alert("FALLO DE SERVIDOR: El servidor respondi√≥ con error " + response.status + ". Verifique su archivo app.py");
    }
  }).catch(error => {
    alert("FALLO DE CONEXI√ìN: No se pudo contactar con Railway. Revise su internet o los logs de la App.");
  });
}
</script>
</body>
</html>
